<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Oss-upload-stream by meteormatt</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Oss-upload-stream</h1>
      <h2 class="project-tagline">A Node.js module for streaming data to Aliyun OSS via the multipart upload API</h2>
      <a href="https://github.com/meteormatt/oss-upload-stream" class="btn">View on GitHub</a>
      <a href="https://github.com/meteormatt/oss-upload-stream/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/meteormatt/oss-upload-stream/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h2>
<a id="oss-upload-stream" class="anchor" href="#oss-upload-stream" aria-hidden="true"><span class="octicon octicon-link"></span></a>oss-upload-stream</h2>

<p><a href="https://badge.fury.io/js/oss-upload-stream"><img src="https://badge.fury.io/js/oss-upload-stream.svg" alt="npm version"></a>
<a href="https://npm.taobao.org/package/oss-upload-stream"><img src="https://npm.taobao.org/badge/v/oss-upload-stream.svg" alt="cnpm version"></a>
<a href="https://travis-ci.org/meteormatt/oss-upload-stream"><img src="https://travis-ci.org/meteormatt/oss-upload-stream.svg?branch=master" alt="Build Status"></a>
<a href="https://david-dm.org/meteormatt/oss-upload-stream"><img src="https://david-dm.org/meteormatt/oss-upload-stream.svg" alt="Dependency Status"></a>
<a href="https://coveralls.io/github/meteormatt/oss-upload-stream?branch=master"><img src="https://coveralls.io/repos/meteormatt/oss-upload-stream/badge.svg?branch=master&amp;service=github" alt="Coverage Status"></a></p>

<p>A pipeable write stream which uploads to Aliyun OSS using the multipart file upload API.</p>

<p>Fork from <a href="https://github.com/nathanpeck/s3-upload-stream">s3-upload-stream</a>.</p>

<h3>
<a id="介绍" class="anchor" href="#%E4%BB%8B%E7%BB%8D" aria-hidden="true"><span class="octicon octicon-link"></span></a>介绍</h3>

<p>阿里云官方的Node.js SDK <a href="https://github.com/aliyun-UED/aliyun-sdk-js">aliyun-sdk</a> 不支持<code>stream</code>方式上传文件到OSS. 
所以我尝试修改了<a href="https://github.com/nathanpeck/s3-upload-stream">s3-upload-stream</a>, 然后移植在<a href="https://github.com/aliyun-UED/aliyun-sdk-js">aliyun-sdk</a>上.</p>

<p>项目取名<code>oss-upload-stream</code>, 并发布到<code>npm</code>上.</p>

<h3>
<a id="样例" class="anchor" href="#%E6%A0%B7%E4%BE%8B" aria-hidden="true"><span class="octicon octicon-link"></span></a>样例</h3>

<p>样例代码请参考<a href="https://github.com/meteormatt/oss-upload-stream/blob/master/examples/upload.js">examples/upload.js</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-c">#!/usr/bin/env node</span>
<span class="pl-k">var</span> <span class="pl-c1">ALY</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>aliyun-sdk<span class="pl-pds">'</span></span>),
    fs <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>fs<span class="pl-pds">'</span></span>);

<span class="pl-c">// Make sure Aliyun credentials are loaded.</span>
<span class="pl-k">var</span> config <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>./config.json<span class="pl-pds">'</span></span>);

<span class="pl-c">// Initialize a stream client.</span>
<span class="pl-k">var</span> ossStream <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>../lib/oss-upload-stream.js<span class="pl-pds">'</span></span>)(<span class="pl-k">new</span> <span class="pl-en">ALY.OSS</span>(config));

<span class="pl-c">// Create the streams</span>
<span class="pl-k">var</span> read <span class="pl-k">=</span> <span class="pl-smi">fs</span>.<span class="pl-en">createReadStream</span>(<span class="pl-s"><span class="pl-pds">'</span>文件路径<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> upload <span class="pl-k">=</span> <span class="pl-smi">ossStream</span>.<span class="pl-en">upload</span>({
  <span class="pl-s"><span class="pl-pds">"</span>Bucket<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>你的bucket<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>Key<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>文件名称<span class="pl-pds">'</span></span>
});

<span class="pl-c">// Handle errors.</span>
<span class="pl-smi">upload</span>.<span class="pl-en">on</span>(<span class="pl-s"><span class="pl-pds">'</span>error<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">error</span>) {
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(error);
});

<span class="pl-c">// Handle progress.</span>
<span class="pl-smi">upload</span>.<span class="pl-en">on</span>(<span class="pl-s"><span class="pl-pds">'</span>part<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">details</span>) {
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(details);
});

<span class="pl-c">// Handle upload completion.</span>
<span class="pl-smi">upload</span>.<span class="pl-en">on</span>(<span class="pl-s"><span class="pl-pds">'</span>uploaded<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">details</span>) {
  <span class="pl-k">var</span> delta <span class="pl-k">=</span> (<span class="pl-k">new</span> <span class="pl-en">Date</span>() <span class="pl-k">-</span> startTime) <span class="pl-k">/</span> <span class="pl-c1">1000</span>;
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(details);
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Completed upload in<span class="pl-pds">'</span></span>, delta, <span class="pl-s"><span class="pl-pds">'</span>seconds<span class="pl-pds">'</span></span>);
});

<span class="pl-c">// Pipe the incoming filestream and upload to Aliyun OSS.</span>
<span class="pl-smi">read</span>.<span class="pl-en">pipe</span>(upload);
<span class="pl-k">var</span> startTime <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Date</span>();</pre></div>

<h3>
<a id="安装" class="anchor" href="#%E5%AE%89%E8%A3%85" aria-hidden="true"><span class="octicon octicon-link"></span></a>安装</h3>

<pre><code>npm install oss-upload-stream
</code></pre>

<h3>
<a id="测试" class="anchor" href="#%E6%B5%8B%E8%AF%95" aria-hidden="true"><span class="octicon octicon-link"></span></a>测试</h3>

<pre><code>npm test
</code></pre>

<h3>
<a id="许可证" class="anchor" href="#%E8%AE%B8%E5%8F%AF%E8%AF%81" aria-hidden="true"><span class="octicon octicon-link"></span></a>许可证</h3>

<p><a href="http://mozillachina.github.io/MPL/">Mozilla 公共许可协议</a></p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/meteormatt/oss-upload-stream">Oss-upload-stream</a> is maintained by <a href="https://github.com/meteormatt">meteormatt</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
